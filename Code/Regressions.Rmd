---
title: "DTC Q3"
author: "Erik Campbell, Kristen Higashi"
date: "8/22/2022"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

  
```{r setup, include=FALSE}
# knitr::opts_chunk$set(echo = TRUE)
    knitr::opts_knit$set(root.dir = normalizePath("/Users/khigashi/Documents/OMSBA/OMSBA-5300-DTC-Erik-collab/data"))
```


<br />

### Purpose Statement
The purpose of this document is to investigate the effect of COVID on working individuals across industries and regions. Retail needs to worry about who has money to spend. In order to have money, you need to make money. Thus our focus is to determine who is working, what they are doing, and how that activity has changed across time. 

### Dataset
Our analysis applies 3 main data sources:

#####  1. IPUMS variables
 IPUMS employment data ([link](https://cps.ipums.org/cps/index.shtml)) - Data collected between January 2019 and Januaray 2021
 
| Variable |  Definition
|:------    |:-------------------------------------------------     | 
| `YEAR` |  |
| `MONTH` |  |
| `EMPSTAT` | |
| `WTFINL` | Survey person weight (as calculated by CPS)|
| `IND`  | Respondent's work industry code |
| `REGION` | Respondents location (regional) |
| `AGE`  | Respondent's age |
| `SEX` |  Marker for respondent sex assigned at birth |
| `RACE` | Marker for espondent's race |

#####  2. Provided industry csv (*indnames.csv*)
  Converts IPUMS industry codes to industry names 
 
| Variable |  Definition
|:------    |:-------------------------------------------------     | 
| `IND` | Work industry code (joins to IPUMS IND field) |
| `indname` | Work industry English name |


#####  3. Provided geographic csv (*state-geocodes-v2021.csv*)
  Converts IPUMS geographies (STATEFIP) to readable geo names.

| Variable |  Definition
|:------    |:-------------------------------------------------     | 
| `STATEFIP` | State FIP code (joins to IPUMS STATEFIP field) |
| `State` | State English name |

### Analysis & Assumptions

**Hypothesis**: for this study was that COVID impacted imployment industries

**Null hypothesis**: Covid did NOT impact employment industries regionally.

**Treatment**: COVID (March 2020 - January 2021

**Control**: Pre-COVID (January 2019 - February 2020)

**Fixed**: Age, Sex, Race - *Age is assumed constant, due to 2 year time period*

**Variables**: Region, Industry, EmploymentStatus 

**Outcome metric**: employmentStatus

**OLS Regression Equation:**
$Employment = B_0 +IndustryB_1 + RegionB_2 + e$


```{r, echo = FALSE}
# Load Relevent Libraries
library(ipumsr)  
library(dplyr)
library(tidyverse)
library(jtools)
library(vtable)
library(lubridate)
library(haven)
library(fixest)
library(ggplot2)
library(formattable)
library(echarts4r)
library(ggplot2)
```


```{r, echo = FALSE}
#### READ IN INDUSTRY CODES ####
Industries <- read_csv('indnames.csv') %>%
  rename(IND = ind)
###### Read in State Federal Information Processing Codes. ######  
state_fips <- read_csv('state-geocodes-v2021.csv') %>%
  filter(!is.na(Region)) %>%
  rename(State = Name) %>%
  select(STATEFIP, State)
###### read in IPUMS demographic data from
dem_ddi <- read_ipums_ddi("cps_00016.xml")
dem_data <- read_ipums_micro(dem_ddi) %>% 
  zap_labels() %>%  
  mutate(
    month_digit= case_when( 
      nchar(str_trim(as.character(MONTH))) ==1 ~ (paste('0',str_trim(as.character(MONTH)), sep = '')),
      nchar(str_trim(as.character(MONTH))) ==2 ~ (str_trim(as.character(MONTH))), 
      TRUE ~ 'WRONG'
    )
    , date_ = as_date(paste(YEAR, month_digit, '01', sep = '-'))
    , period_type = as_factor(case_when(
      date_ < '2020-03-01' ~'Pre_Covid', 
      date_ >= '2020-03-01' & date_ < '2020-04-01' ~'Covid', 
      date_ >= '2020-04-01' ~'Post_Covid'
    ))
  )
#### JOIN FILES INTO ONE ####
DF <- dem_data %>% 
  ## Join in geographic info
  left_join(state_fips, by = 'STATEFIP') %>% # 3.9 million observations
  ## Join in industry categories
  left_join(Industries, by = 'IND')
#### DEMOGRAPHICS DATAFRAME ####
demo_data <- DF %>%
  mutate(EmploymentStatus = case_when(
    EMPSTAT <= 1 | EMPSTAT >= 30 ~  'Other',
    EMPSTAT >= 10 & EMPSTAT < 20 ~ '1',
    EMPSTAT >= 20 & EMPSTAT < 30 ~ '0')) %>%
  mutate(sex = case_when(
    SEX == 1 ~  'male',
    SEX == 2 ~ 'female')) %>%
  mutate(MARST = case_when(
    MARST == 1 ~ 'Married',
    MARST != 1 ~ 'Single')) %>%
  mutate(RACE = case_when(
    HISPAN == '0' & RACE == '100' ~ 'White',
    HISPAN == '0' & RACE == '200' ~ 'Black',  
    HISPAN == '0' & RACE == '300' ~ 'AmericanIndian',
    HISPAN == '0' & RACE %in% c('650', '651', '652') ~ 'Asian',
    HISPAN == '0' & !(RACE %in% c('100', '200', '300', '650', '651', '652')) ~ 'MixedRace',
    HISPAN != '0' ~ 'Latino')) %>%
  mutate(AgeGroup = case_when(
    AGE < 20 ~ 'under20',
    AGE >= 20 & AGE < 30 ~ '20to29',
    AGE >= 30 & AGE < 40 ~ '30to39',
    AGE >= 40 & AGE < 50 ~ '40to49',
    AGE >= 50 & AGE < 60 ~ '50to59',
    AGE >= 60 & AGE <= 65 ~ '60to65',
    AGE >= 65 ~ 'RetirementAge')) %>%
  mutate(REGION = case_when(
    REGION == 11 | REGION == 12 ~ 'Northeast',
    REGION == 21 | REGION == 22 ~ 'Midwest',
    REGION == 31 | REGION == 32 |  REGION == 33 ~ 'South',
    REGION == 41 | REGION == 42 ~ 'West',
    REGION == 97 ~ 'Unknown')) %>%
  mutate(METRO = case_when (
    METRO %in% c(0, 4) ~  'Other',
    METRO == 1 ~  'Rural',
    METRO == 2 ~  'CityCenter',
    METRO == 3 ~  'Suburb')) %>%
  mutate(Education = case_when(
    EDUC99 == 00 ~ 'Unknown',
    EDUC99 >= 1 & EDUC99 <=9 ~ 'NoDiploma',
    EDUC99 == 10 ~ 'HighSchoolDiploma',
    EDUC99 == 11 ~ 'SomeCollege',
    EDUC99 >= 12 & EDUC99 <= 14 ~  'AssociateDegree',
    EDUC99 == 15 ~ 'Bachelors',
    EDUC99 == 16 ~ 'Masters',
    EDUC99 > 16 ~ 'PhDProfessional')) %>%
  mutate(LaborForce = case_when(
    LABFORCE == 0  ~ 'Military',
    LABFORCE == 1  ~ '0',
    LABFORCE == 2  ~ '1')) %>%
  mutate(WorkStatus = case_when(
    WKSTAT %in% c(11, 14, 15) ~ 'FullTime',
    WKSTAT %in% c(12, 20, 21, 22, 40, 41) ~ 'PartTime',
    WKSTAT == 13 ~ 'FullTimeNoWork',
    WKSTAT == 42 ~ 'PartTimeNoWork',
    WKSTAT == 50 ~ 'NoWorkSeekingFullTime',
    WKSTAT == 60 ~ 'NoWorkSeekingPartTime',
    WKSTAT == 99 ~ 'MilitaryNoLaborForce',)) %>%
  mutate(FamilyIncome =case_when(                        
    FAMINC <= 600 ~ '<$25k_FPL_Familyof4',
    FAMINC > 600 & FAMINC <= 740 ~ '25k-50K',
    FAMINC > 740 & FAMINC <= 830 ~ '50k-75k',
    FAMINC > 830 & FAMINC <= 841~ '75k-100k',
    FAMINC == 842  ~ '100k - 150k',
    FAMINC == 843 ~ '150k+',
    FAMINC == 999 ~ 'NA')) %>%
  mutate(WHYUNEMP = case_when(
    WHYUNEMP <= 3 ~ 'LostJob',
    WHYUNEMP == 4 ~ 'Quit',
    WHYUNEMP == 5 ~ 'ReEnterLaborForce',
    WHYUNEMP == 6 ~ 'FirstJob',
    WHYUNEMP == 0 ~ 'Military')) %>%
  mutate(employed = ifelse(EMPSTAT <20, 1, 0), unemployed = ifelse(EMPSTAT > 20, 1, 0)) %>% 
  mutate(is_employed = ifelse(EMPSTAT<20 & EMPSTAT>10, TRUE, FALSE)) %>% 
  mutate(cats2 = ifelse(indname=='Retail Trade', 'Retail', 'Other') ## flag if industry == Retail
  )%>% 
  filter(EMPSTAT < 30 & EMPSTAT >= 10) %>% 
  mutate_if(is.character, as.factor) %>%
  unite(HHID, HRHHID, HRHHID2) %>%     #When combined with HRHHID2, HRHHID can uniquely identify households within basic monthly samples-IPUMS
  # mutate(HHID = as.numeric(HHID)) %>%
  drop_na(indname) %>% # Dropping N/A's in indname as NIU's in military.
  select(date_, YEAR, MONTH, HHID, PERNUM, EMPSTAT, is_employed, CPSID, CPSIDP
         , HWTFINL, WTFINL, FAMINC, REGION, METRO, AGE, AgeGroup, SEX, sex
         , RACE, MARST, IND, WHYUNEMP, AgeGroup, Education, LaborForce
         , EmploymentStatus, WorkStatus, FamilyIncome, indname, cats2, State, period_type)
```


# Explatory Data Analysis
```{r}
# distinct people in survey = 500,130
summary(demo_data)
vtable(demo_data, lush = TRUE)


```

# Data Exploration
```{r}
reg_df_vis<- demo_data %>% 
  select(period_type
         , date_
         ## Measure
         , is_employed
         , WTFINL
         ## Variables
         , IND, indname, REGION
         ## Fixed
         , AGE, sex, RACE
  )

unemp_by_race <- demo_data %>% 
  group_by(period_type, date_, RACE) %>%
  summarize(UnemploymentRate = 1- (weighted.mean(is_employed == TRUE, w = WTFINL))) %>% 
  ggplot(aes(x = date_, y = UnemploymentRate, color = RACE))+ geom_line()+
  geom_vline(xintercept=as_date('2020-03-01'),
                color = "red", size=1)+
  geom_vline(xintercept=as_date('2020-04-01'), 
                color = "red", size=1)
# + geom_smooth(method = 'lm')

unemp_by_age_group <- demo_data %>% 
  group_by(period_type, date_, AgeGroup) %>%
  summarize(UnemploymentRate = 1- (weighted.mean(is_employed == TRUE, w = WTFINL))) %>% 
  ggplot(aes(x = date_, y = UnemploymentRate, color = AgeGroup))+ geom_line()+
  geom_vline(xintercept=as_date('2020-03-01'),
                color = "red", size=1)+
  geom_vline(xintercept=as_date('2020-04-01'), 
                color = "red", size=1)


unemp_by_industry_retail <- demo_data %>% 
  group_by(period_type, date_, cats2) %>%
  summarize(UnemploymentRate = 1- (weighted.mean(is_employed == TRUE, w = WTFINL))) %>% 
  ggplot(aes(x = date_, y = UnemploymentRate, color = cats2))+ geom_line()+
  geom_vline(xintercept=as_date('2020-03-01'),
                color = "red", size=1)+
  geom_vline(xintercept=as_date('2020-04-01'), 
                color = "red", size=1)


unemp_by_region <- demo_data %>% 
  group_by(period_type, date_, REGION) %>%
  summarize(UnemploymentRate = 1- (weighted.mean(is_employed == TRUE, w = WTFINL))) %>% 
  ggplot(aes(x = date_, y = UnemploymentRate, color = REGION))+ geom_line()+
  geom_vline(xintercept=as_date('2020-03-01'),
                color = "red", size=1)+
  geom_vline(xintercept=as_date('2020-04-01'), 
                color = "red", size=1)



unemp_by_is_emp<- demo_data %>% 
  group_by(date_, is_employed) %>%
  mutate(employ  = n()) %>% 
  ggplot(aes(x = date_, y = employ, color = is_employed))+ geom_area()+
  geom_vline(xintercept=as_date('2020-03-01'),
                color = "red", size=1)+
  geom_vline(xintercept=as_date('2020-04-01'), 
                color = "red", size=1)
unemp_by_is_emp
```

### Employment / Unemployment 
```{r}
EMP_INDUSTRY <- demo_data %>%
  filter(EMPSTAT < 30 & EMPSTAT >= 10) %>%
  group_by(date_, indname, period_type, is_employed) %>%
  summarize(UmploymentRateIndustry = 1- (weighted.mean(is_employed == TRUE, w = WTFINL))) %>%
  filter(indname != 'Military', indname != 'Other') %>% 
  ggplot(aes(x = date_, y = UmploymentRateIndustry, color = cats2))+ geom_line()+
  geom_vline(xintercept=as_date('2020-03-01'), 
                color = "red", size=1)+
  geom_vline(xintercept=as_date('2020-04-01'), 
                color = "red", size=1)+
   theme(legend.position="right")
EMP_INDUSTRY

```

```{r}
##### METRO-PRE-COVID #####

EMP_Metro <- demo_data %>%
  filter(EMPSTAT < 30 & EMPSTAT >= 10) %>%
  mutate(employed = ifelse(EMPSTAT <20, 1, 0)
         , unemployed = ifelse(EMPSTAT > 20, 1, 0)) %>%
  group_by(date_, period_type, METRO) %>%
  summarize(UnemploymentRate = 1- (weighted.mean(employed == 1, w = WTFINL))) %>%
  ggplot(aes(x = date_, y = UnemploymentRate, color = cats2))+ geom_line()+
  geom_vline(xintercept=as_date('2020-03-01'), 
                color = "red", size=1)+
  geom_vline(xintercept=as_date('2020-04-01'), 
                color = "red", size=1)+
   theme(legend.position="right")
EMP_Metro

```


```{r}
##### Construct chartS for Pre-covid unemployment by METRO, SUBURBAN, RURAL #####
EMPC <- EMP_Metro %>%
  pivot_wider(1, names_from = "METRO", values_from = "UnemploymentRate") %>% 
  ungroup() %>% 
  e_charts(date_) %>%
  e_line(CityCenter, color="#333") %>%
  e_line(Other, color="blue") %>%
  e_line(Rural, color="green") %>%
  e_line(Suburb, color="orange") %>%
  e_tooltip(trigger = "axis")

EMPC_avg <- EMPC %>%
  group_by() %>%
  summarise(
    CityCenter = mean(CityCenter),
    Other = mean(Other),
    Rural = mean(Rural),
    Suburb = mean(Suburb)) %>%
  ungroup()
EMPC

EMPC_avg
#create a dataframe with values to chart
EMPC_avg_bar <- data.frame(
  names = c("CityCenter", "Other", "Rural", "Suburb"),
  values = c(0.0379, 0.0353, 0.0383, 0.0301))

##### Employment average by CityCenter, Rural, Suburb #####
EMPC_avg_bar %>%
  e_charts(names) %>%
  e_bar(values)

##### METRO-COVID #####
EMP_Metro_Covid <- demo_data %>%
  filter(EMPSTAT < 30 & EMPSTAT >= 10) %>%
  mutate(employed = ifelse(EMPSTAT <20, 1, 0), unemployed = ifelse(EMPSTAT > 20, 1, 0)) %>%
  group_by(METRO, period_type) %>%
  summarize(UnemploymentRate = 1- (weighted.mean(employed == 1, w = WTFINL))) %>% 
  ggplot(aes(x = date_, y = UnemploymentRate, color = cats2))+ geom_line()+
  geom_vline(xintercept=as_date('2020-03-01'), 
                color = "red", size=1)+
  geom_vline(xintercept=as_date('2020-04-01'), 
                color = "red", size=1)+
   theme(legend.position="right")
```

```{r}
##### Construct chartS for COVID unemployment by METRO, SUBURBAN, RURAL #####
EMPMC <- EMP_Metro_Covid %>%
  ungroup()

EMPMC %>%
  e_charts(METRO) %>%
  e_bar(UnemploymentRate) %>%
  e_tooltip()

##### Construct chartS for POST-COVID unemployment by METRO, SUBURBAN, RURAL #####

EMPMPC <- EMP_Metro_PostCovid %>%
  ungroup()

EMPMPC %>%
  e_charts(METRO) %>%
  e_bar(UnemploymentRate) %>%
  e_tooltip()
```

``` {r}
################# REGION #####
##### REGION-PRE-COVID ####

EMP_REGION_PreCovid <- demo_data %>%
  filter(EMPSTAT < 30 & EMPSTAT >= 10) %>%
  mutate(employed = ifelse(EMPSTAT <20, 1, 0), unemployed = ifelse(EMPSTAT > 20, 1, 0)) %>%
  group_by(date_, period_type, REGION) %>%
  summarize(UnemploymentRate = 1- (weighted.mean(employed == 1, w = WTFINL)))%>%  # ungroup
  ungroup() %>%  #need to pivot wider
  pivot_wider(1, names_from = "REGION", values_from = "UnemploymentRate")

```

```{r}
###### Construct chartS for PRE-COVID unemployment by REGION ####


EMP_REGION_PreCovid <- EMP_REGION_PreCovid %>%  #need to pivot wider
  pivot_wider(1, names_from = "REGION", values_from = "UnemploymentRate")

# unemployment by region PRE-COVID line
EMP_REGION_PreCovid %>%
  ungroup() %>% # ungroup is needed after doing group_by()
  e_charts(date_) %>%
  e_line(Midwest) %>%
  e_line(Northeast) %>%
  e_line(South) %>%
  e_line(West, color="orange") %>%
  e_tooltip(trigger = "axis")

# mean unemployment pre-covid
EMPRPC <- EMP_REGION_PreCovid %>%
  group_by() %>%
  summarise(
    Midwest = mean(Midwest),
    Northeast = mean(Northeast),
    South = mean(South),
    West = mean(West))

#create dataframe for above values
EMP_REGION_PreCovid1 <- data.frame(
  REGION = c("Midwest", "Northeast", "South", "West"),
  UnemploymentRate = c(0.0339, 0.0344, 0.0324, 0.0362)
)

EMP_REGION_PreCovid1 %>%
  ungroup() %>%
  e_chart(REGION) %>%
  e_bar(UnemploymentRate)


```

```{r}
##### REGION-COVID ####
EMP_REGION_Covid <- demo_data %>%
  filter(EMPSTAT < 30 & EMPSTAT >= 10) %>%
  mutate(employed = ifelse(EMPSTAT <20, 1, 0), unemployed = ifelse(EMPSTAT > 20, 1, 0)) %>%
  group_by(date_, period_type, REGION) %>%
  summarize(UnemploymentRate = 1- (weighted.mean(employed == 1, w = WTFINL))) %>% 
  ggplot(aes(x = date_, y = UnemploymentRate, color = cats2))+ geom_line()+
  geom_vline(xintercept=as_date('2020-03-01'), 
                color = "red", size=1)+
  geom_vline(xintercept=as_date('2020-04-01'), 
                color = "red", size=1)+
   theme(legend.position="right")

###### construct chart of unemployment by REGION for COVID ####

EMP_REGION_Covid %>%
  ungroup() %>%
  e_chart(REGION) %>%
  e_bar(UnemploymentRate)
```

```{r}


########### RACE ################################################################################
#### RACE PRE-COVID EMPLOYMENT ####
EMP_RACE_Precovid <- demo_data %>%
  filter(EMPSTAT < 30 & EMPSTAT >= 10) %>%
  mutate(employed = ifelse(EMPSTAT <20, 1, 0), unemployed = ifelse(EMPSTAT > 20, 1, 0)) %>%
  group_by(indname, date_, period_type, RACE) %>%
  summarize(UnemploymentRate = 1- (weighted.mean(employed == 1, w = WTFINL))) %>% 
  ggplot(aes(x = date_, y = UnemploymentRate, color = cats2))+ geom_line()+
  geom_vline(xintercept=as_date('2020-03-01'), 
                color = "red", size=1)+
  geom_vline(xintercept=as_date('2020-04-01'), 
                color = "red", size=1)+
   theme(legend.position="right")
```

```{r}
#### EMP AGGREGATE (SEX/AGE/GROUP) ####
################ PRE-COVID AGG #################
##### race #####
EMP_AGG_Precovid_race <- demo_data %>%
  mutate(employed = ifelse(EMPSTAT <20, 1, 0), unemployed = ifelse(EMPSTAT > 20, 1, 0)) %>%
  group_by(date_, period_type, RACE) %>%
  summarize(UnemploymentRate = 1- (weighted.mean(employed == 1, w = WTFINL))) %>% 
  ggplot(aes(x = date_, y = UnemploymentRate, color = cats2))+ geom_line()+
  geom_vline(xintercept=as_date('2020-03-01'), 
                color = "red", size=1)+
  geom_vline(xintercept=as_date('2020-04-01'), 
                color = "red", size=1)+
   theme(legend.position="right")

##### sex/race #####
EMP_AGG_Precovid_sex_race <- demo_data %>%
  filter(EMPSTAT < 30 & EMPSTAT >= 10) %>%
  mutate(employed = ifelse(EMPSTAT <20, 1, 0), unemployed = ifelse(EMPSTAT > 20, 1, 0)) %>%
  group_by(date_, period_type, sex, RACE) %>%
  summarize(UnemploymentRate = 1- (weighted.mean(employed == 1, w = WTFINL))) %>% 
  ggplot(aes(x = date_, y = UnemploymentRate, color = cats2))+ geom_line()+
  geom_vline(xintercept=as_date('2020-03-01'), 
                color = "red", size=1)+
  geom_vline(xintercept=as_date('2020-04-01'), 
                color = "red", size=1)+
   theme(legend.position="right")
head(EMP_AGG_Precovid_sex_race)
##### sex/AgeGroup #####
EMP_AGG_Precovid_sex_age <- demo_data %>%
  filter(EMPSTAT < 30 & EMPSTAT >= 10) %>%
  mutate(employed = ifelse(EMPSTAT <20, 1, 0), unemployed = ifelse(EMPSTAT > 20, 1, 0)) %>%
  group_by(date_, period_type, sex, AgeGroup) %>%
  summarize(UnemploymentRate = 1- (weighted.mean(employed == 1, w = WTFINL))) %>% 
  ggplot(aes(x = date_, y = UnemploymentRate, color = cats2))+ geom_line()+
  geom_vline(xintercept=as_date('2020-03-01'), 
                color = "red", size=1)+
  geom_vline(xintercept=as_date('2020-04-01'), 
                color = "red", size=1)+
   theme(legend.position="right")

##### race/AgeGroup #####
EMP_AGG_Precovid_race_age <- demo_data %>%
  filter(EMPSTAT < 30 & EMPSTAT >= 10) %>%
  mutate(employed = ifelse(EMPSTAT <20, 1, 0), unemployed = ifelse(EMPSTAT > 20, 1, 0)) %>%
  group_by(date_, period_type, RACE, AgeGroup) %>%
  summarize(UnemploymentRate = 1- (weighted.mean(employed == 1, w = WTFINL))) %>% 
  ggplot(aes(x = date_, y = UnemploymentRate, color = cats2))+ geom_line()+
  geom_vline(xintercept=as_date('2020-03-01'), 
                color = "red", size=1)+
  geom_vline(xintercept=as_date('2020-04-01'), 
                color = "red", size=1)+
   theme(legend.position="right")

```
### Retail v Industries
```{r}

reg_df_vis %>% 
  mutate(cats2 = ifelse(indname=='Retail Trade', 'Retail', 'Other')) %>% 
  group_by(period_type, date_, cats2) %>%
  summarize(UnemploymentRate = 1- (weighted.mean(is_employed == TRUE, w = WTFINL))) %>% 
  ggplot(aes(x = date_, y = UnemploymentRate, color = cats2))+ geom_line()+
  geom_vline(xintercept=as_date('2020-03-01'), 
                color = "red", size=1)+
  geom_vline(xintercept=as_date('2020-04-01'), 
                color = "red", size=1)+
   theme(legend.position="right")
```



```{r}
head(demo_data)
# 
# EMP_INDUSTRY <- demo_data %>%
#   group_by(date_, indname, period_type) %>%
#   summarize(UmploymentRateIndustry = 1- (weighted.mean(employed == 1, w = WTFINL))) %>%
#   filter(indname != 'Military', indname != 'Other')
reg_df <- demo_data %>% 
  select(period_type
         , date_
         ## Measure
         , is_employed
         , WTFINL
         ## Variables
         , IND, indname, REGION
         ## Fixed
         , AGE, sex, RACE
  )
summary(reg_df)
reg1 <- reg_df %>% 
  feols(is_employed~period_type, se = 'hetero')
reg2 <- reg_df %>% 
  feols(is_employed~period_type+ RACE, se = 'hetero')
reg3 <- reg_df %>% 
  feols(is_employed~period_type | RACE)
etable(reg2, reg3)
reg4 <- reg_df %>% 
  feols(is_employed~period_type | AGE)
reg5 <- reg_df %>%
  feols((is_employed~period_type*indname))
etable(reg1, reg2, reg3, reg4, reg5)

ggplot(reg_df, aes(x = period_type, y = is_employed)) + geom_point() + geom_smooth(method = 'lm')

``` 

